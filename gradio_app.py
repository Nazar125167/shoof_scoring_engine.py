import streamlit as st

# ๐จ ุฃูู ุฎุทูุฉ: ุงุณุชูุฑุงุฏ ุฏุงูุฉ ุงูุชุดุบูู ุงูุฑุฆูุณูุฉ ูู ููู ุชุฏูู ุงูุฐูุงุก
# ูุฐุง ูุฑุจุท ุงููุงุฌูุฉ (ุงูู Demo) ุจูุญุฑู ุงูุญุณุงุจ (ุงูููุทู ุงูุฑูุงุถู)
try:
    from shoof_ai_flow import run_shoof_flow
except ImportError:
    st.error("ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุฏุงูุฉ 'run_shoof_flow'. ุชุฃูุฏ ูู ุฑูุน ููู shoof_ai_flow.py.")
    st.stop()


# === 1. ุฅุนุฏุงุฏ ุงูุตูุญุฉ ูุงูุญุงูุฉ ===

# ุฅุนุฏุงุฏ ุดูู ุงูุตูุญุฉ
st.set_page_config(
    page_title="ูููู ุดููู - ูุคุดุฑ ุงูุซูุฉ 9.7", 
    layout="wide", 
    initial_sidebar_state="collapsed"
)

# ุชููุฆุฉ ุญุงูุฉ ุงูุฌูุณุฉ (ููุชุฐูุฑ ุจูู ุชูุงุนูุงุช ุงููุณุชุฎุฏู)
if "step" not in st.session_state:
    st.session_state.step = 1
    st.session_state.company_name = None
    st.session_state.priority = None

# === 2. ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุฑุฆูุณูุฉ ===

st.title("๐ค ูููู ุดููู ุงูุฐูู: ูุคุดุฑ ุงูุซูุฉ 9.7")
st.markdown("""
    ---
    **ุงููุฏู:** ุชุดุฎูุต ุฃุฏุงุก ุดุฑูุงุช ุงูุฎุฏูุงุช ุงูููุฏุงููุฉ ูุชูููุฏ ุชูุตูุงุช ููุฎุตุตุฉ.
    """)

# === 3. ุญููุฉ ุงูุชูุงุนู (ุงูุฎุทูุฉ 1: ุชุญุฏูุฏ ุงูุดุฑูุฉ) ===

if st.session_state.step == 1:
    st.info("ูุฑุญุจุงู! ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงูุดุฑูุฉ ุงูุชู ุชุฑูุฏ ุชุญููููุง ูุชุญุฏูุฏ ุงููุทุงู.")
    
    # ูุฑุจุน ุฅุฏุฎุงู ุงุณู ุงูุดุฑูุฉ
    company_input = st.text_input(
        "**ุงูุฎุทูุฉ 1: ุฃุฏุฎู ุงุณู ุงูุดุฑูุฉ:**",
        placeholder="ูุซุงู: ููุฑุจุงุก ุงูุฏูุญุฉ ุงููุชุฎุตุต"
    )
    
    if st.button("ุชุฃููุฏ ุงุณู ุงูุดุฑูุฉ ูุฅุฑุณุงู ูููููู"):
        if company_input:
            st.session_state.company_name = company_input
            st.session_state.step = 2
            st.rerun()
        else:
            st.warning("ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงูุดุฑูุฉ ูููุชุงุจุนุฉ.")

# === 4. ุญููุฉ ุงูุชูุงุนู (ุงูุฎุทูุฉ 2: ุชุญุฏูุฏ ุงูุฃููููุฉ) ===

elif st.session_state.step == 2:
    st.info(f"ูููู ุดููู: ููุชุงุฒ! ุฃูุช ุงูุขู ุชุญูู ุดุฑูุฉ **{st.session_state.company_name}**.")
    st.write("ูุชูุฏูู ุชูุตูุฉ ููุฎุตุตุฉ (ุฃูุซุฑ ูููุฉ ูููุณุชุซูุฑ)ุ **ูุง ูู ุงูุฃููููุฉ ุงูุงุณุชุฑุงุชูุฌูุฉ ุงูุญุงููุฉ ููุดุฑูุฉุ**")
    
    # ุงุฎุชูุงุฑ ุงูุฃููููุฉ (ุชุฎุตูุต ุงูุฃูุฒุงู)
    priority_option = st.radio(
        "**ุงูุฎุทูุฉ 2: ุงุฎุชุฑ ุฃููููุฉ ุงูุดุฑูุฉ:**",
        ('ุงูุฌูุฏุฉ (ูุชุญุณูู ุฑุถุง ุงูุนููุงุก)', 'ุงูุณุนุฑ/ุงูุชูููุฉ (ูุฎูุถ ุงููุตุฑููุงุช)'),
        index=0 # ุงูุงูุชุฑุงุถู ูู ุงูุฌูุฏุฉ
    )
    
    if st.button("ุชุดุบูู ูุญุฑู ุงูุญุณุงุจ ูุงูุญุตูู ุนูู ุชูุฑูุฑ ุดููู"):
        # ุชุญููู ุงูุฎูุงุฑ ุฅูู ุงููุต ุงูุนุฑุจู ุงูุตุงูู ุงููุณุชุฎุฏู ูู ุงูููุฏ ุงูุฑูุงุถู
        if priority_option == 'ุงูุฌูุฏุฉ (ูุชุญุณูู ุฑุถุง ุงูุนููุงุก)':
             st.session_state.priority = 'ุฌูุฏุฉ'
        else:
             st.session_state.priority = 'ุณุนุฑ'
             
        st.session_state.step = 3
        st.rerun()

# === 5. ุญููุฉ ุงูุชูุงุนู (ุงูุฎุทูุฉ 3: ุนุฑุถ ุงูุชูุฑูุฑ ุงูููุงุฆู) ===

elif st.session_state.step == 3:
    st.markdown(f"## โณ ุฌุงุฑู ุชุญููู {st.session_state.company_name}...")
    
    # 1. ุดุฑูุท ุชุญููู ูุน ุฑุณุงูุฉ ููุชุฃุซูุฑ ุงูุจุตุฑู
    with st.spinner(f"ุฌุงุฑู ุชุทุจูู ูุนุงุฏูุงุช ูุคุดุฑ 9.7 ูุชุนุฏูู ุงูุฃูุฒุงู ุจูุงุกู ุนูู ุฃููููุฉ: **{st.session_state.priority}**..."):
        # 2. ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ุงูุชู ุชุดุบู ูุญุฑู ุงูุญุณุงุจ
        # **ูุฐู ุงูุฏุงูุฉ ููุฌูุฏุฉ ูู ููู shoof_ai_flow.py**
        final_report_markdown = run_shoof_flow(
            st.session_state.company_name, 
            st.session_state.priority
        )
        
    st.success("โ ุงูุชูู ุงูุชุญููู! ุฅููู ุชูุฑูุฑ ุดููู ุงููุฎุตุต.")
    st.markdown("---")
    
    # 3. ุนุฑุถ ุงูุชูุฑูุฑ ุงูููุงุฆู
    st.markdown(final_report_markdown, unsafe_allow_html=True)
    
    st.markdown("---")
    # ุฒุฑ ุฅุนุงุฏุฉ ุงูุชุดุบูู
    if st.button("ุจุฏุก ุชุญููู ุฌุฏูุฏ (ุฅุนุงุฏุฉ ุชุดุบูู ุงูู Demo)"):
        st.session_state.step = 1
        st.session_state.company_name = None
        st.session_state.priority = None
        st.rerun()
